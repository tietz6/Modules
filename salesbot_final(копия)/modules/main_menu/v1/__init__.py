"""
–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞ - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞.
–£–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏ –æ–±—É—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏.
"""

try:
    from aiogram import types
    from aiogram import Dispatcher
    from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
    AIOGRAM_AVAILABLE = True
except ImportError:
    AIOGRAM_AVAILABLE = False
    types = None
    Dispatcher = None
    ReplyKeyboardMarkup = None
    KeyboardButton = None


def get_main_menu_keyboard():
    """–°–æ–∑–¥–∞—ë—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å –º–æ–¥—É–ª—è–º–∏ –æ–±—É—á–µ–Ω–∏—è"""
    if not AIOGRAM_AVAILABLE:
        return None
    
    keyboard = ReplyKeyboardMarkup(
        keyboard=[
            [KeyboardButton(text="üß≠ –ü—É—Ç—å –ú–∞—Å—Ç–µ—Ä–∞")],
            [KeyboardButton(text="üõ°Ô∏è‚öîÔ∏è –©–∏—Ç –∏ –ú–µ—á")],
            [KeyboardButton(text="üèÜ –í–∫—É—Å –ü–æ–±–µ–¥—ã")],
            [KeyboardButton(text="üêâ –°–ø—è—â–∏–π –î—Ä–∞–∫–æ–Ω")],
            [KeyboardButton(text="üé≠ –ê—Ä–µ–Ω–∞")],
        ],
        resize_keyboard=True,
        one_time_keyboard=False
    )
    return keyboard


def get_welcome_message():
    """–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç Tietz"""
    return (
        "üëã <b>–ü—Ä–∏–≤–µ—Ç! –Ø Tietz</b> ‚Äî —Ç–≤–æ–π –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º.\n\n"
        "üéØ <b>–ú–æ—è –∑–∞–¥–∞—á–∞</b>: –ø–æ–º–æ—á—å —Ç–µ–±–µ —Å—Ç–∞—Ç—å –º–∞—Å—Ç–µ—Ä–æ–º –ø—Ä–æ–¥–∞–∂ –Ω–∞—à–∏—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤:\n"
        "‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Å–Ω–∏ –ø–æ –∏—Å—Ç–æ—Ä–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞\n"
        "‚Ä¢ –û–∂–∏–≤–ª–µ–Ω–∏–µ —Ñ–æ—Ç–æ (–∂–∏–≤—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏)\n"
        "‚Ä¢ –ü–µ—Å–Ω–∏ –≥–æ–ª–æ—Å–æ–º –∫–ª–∏–µ–Ω—Ç–∞ (voice cloning)\n"
        "‚Ä¢ –í–∏–¥–µ–æ—Ä–æ–ª–∏–∫–∏-–ø–æ–¥–∞—Ä–∫–∏ —Å –º–æ–Ω—Ç–∞–∂–æ–º\n"
        "‚Ä¢ –ü—Ä–µ–º–∏–∞–ª—å–Ω—ã–µ –º—É–ª—å—Ç-–∏—Å—Ç–æ—Ä–∏–∏ –ø–æ –ª—é–±–≤–∏\n\n"
        "üí° <b>–ö–∞–∫ —è —Ä–∞–±–æ—Ç–∞—é</b>:\n"
        "–Ø –±—É–¥—É –∏–≥—Ä–∞—Ç—å —Ä–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∞, –¥–∞–≤–∞—Ç—å —Ç–µ–±–µ –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å –∏ –ø–æ–º–æ–≥–∞—Ç—å "
        "—Ä–∞–∑–≤–∏–≤–∞—Ç—å –Ω–∞–≤—ã–∫–∏ –ø—Ä–æ–¥–∞–∂ —á–µ—Ä–µ–∑ –ø—Ä–∞–∫—Ç–∏–∫—É –∏ —Ä–∞–∑–±–æ—Ä.\n\n"
        "üìö <b>–í—ã–±–µ—Ä–∏ –º–æ–¥—É–ª—å –æ–±—É—á–µ–Ω–∏—è:</b>"
    )


def register_telegram(dp, registry):
    """
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Ç–µ–ª–µ–≥—Ä–∞–º-—Ö—ç–Ω–¥–ª–µ—Ä—ã –¥–ª—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é.
    –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º telegram/autoload.py.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç aiogram v2 —Å–∏–Ω—Ç–∞–∫—Å–∏—Å.
    """
    if not AIOGRAM_AVAILABLE:
        return
    
    @dp.message_handler(commands=["start", "menu"])
    async def _cmd_start(message: types.Message):
        """
        –ö–æ–º–∞–Ω–¥–∞ /start - –≥–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –±–æ—Ç–∞.
        –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –æ—Ç Tietz + –º–µ–Ω—é –º–æ–¥—É–ª–µ–π.
        """
        welcome_text = get_welcome_message()
        keyboard = get_main_menu_keyboard()
        
        await message.reply(
            welcome_text,
            reply_markup=keyboard,
            parse_mode="HTML"
        )
    
    @dp.message_handler(lambda message: message.text == "üß≠ –ü—É—Ç—å –ú–∞—Å—Ç–µ—Ä–∞")
    async def _menu_master_path(message: types.Message):
        """–ó–∞–ø—É—Å–∫ –º–æ–¥—É–ª—è –ü—É—Ç—å –ú–∞—Å—Ç–µ—Ä–∞"""
        from modules.master_path.v3.engine import MasterPath
        
        user_id = str(message.from_user.id)
        mp = MasterPath(user_id)
        state = mp.snapshot()
        
        stages_ru = {
            "greeting": "–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ",
            "qualification": "–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è",
            "support": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞",
            "offer": "–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
            "demo": "–î–µ–º–æ",
            "final": "–ó–∞–∫—Ä—ã—Ç–∏–µ",
            "done": "–ó–∞–≤–µ—Ä—à–µ–Ω–æ"
        }
        
        stage_name = stages_ru.get(state['stage'], state['stage'])
        
        help_text = (
            "üéØ <b>–ü—É—Ç—å –ú–∞—Å—Ç–µ—Ä–∞</b> - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–¥–∞–∂–∏\n\n"
            f"üìç –¢–µ–∫—É—â–∏–π —ç—Ç–∞–ø: <b>{stage_name}</b>\n\n"
            "üìù <b>–≠—Ç–∞–ø—ã –æ–±—É—á–µ–Ω–∏—è:</b>\n"
            "1Ô∏è‚É£ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ —Ç–æ–Ω –±—Ä–µ–Ω–¥–∞\n"
            "2Ô∏è‚É£ –°–±–æ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞\n"
            "3Ô∏è‚É£ –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã\n"
            "4Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤ –ø–µ—Å–Ω–∏\n"
            "5Ô∏è‚É£ –í—ã–±–æ—Ä –∂–∞–Ω—Ä–∞ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è\n"
            "6Ô∏è‚É£ –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ\n"
            "7Ô∏è‚É£ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã\n"
            "8Ô∏è‚É£ –î–µ–º–æ A/B\n"
            "9Ô∏è‚É£ –§–∏–Ω–∞–ª –∏ –¥–æ–ø—Ä–æ–¥–∞–∂–∏\n\n"
            "üí¨ –ù–∞—á–Ω–∏ –¥–∏–∞–ª–æ–≥, —è –±—É–¥—É –∏–≥—Ä–∞—Ç—å —Ä–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∞.\n"
            "–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π —Ä–µ–ø–ª–∏–∫–∏ —è –¥–∞–º —Ç–µ–±–µ —Ä–∞–∑–±–æ—Ä!\n\n"
            "üîô –ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π /start"
        )
        
        # –ü—Ä–æ—Å—Ç–∞—è inline-–∫–Ω–æ–ø–∫–∞ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        inline_kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ", callback_data="mp_reset")],
            [InlineKeyboardButton(text="üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å", callback_data="mp_status")]
        ])
        
        await message.reply(help_text, reply_markup=inline_kb, parse_mode="HTML")
    
    @dp.message_handler(lambda message: message.text == "üõ°Ô∏è‚öîÔ∏è –©–∏—Ç –∏ –ú–µ—á")
    async def _menu_objections(message: types.Message):
        """–ó–∞–ø—É—Å–∫ –º–æ–¥—É–ª—è –©–∏—Ç –∏ –ú–µ—á (–≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è)"""
        help_text = (
            "üõ°Ô∏è‚öîÔ∏è <b>–©–∏—Ç –∏ –ú–µ—á</b> - –†–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏\n\n"
            "üéØ <b>–¶–µ–ª—å:</b> –Ω–∞—É—á–∏—Ç—å—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤\n\n"
            "üë• <b>–¢–∏–ø—ã –∫–ª–∏–µ–Ω—Ç–æ–≤:</b>\n"
            "‚Ä¢ –°–∫–µ–ø—Ç–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞\n"
            "‚Ä¢ –¶–µ–Ω–æ–≤–æ–π\n"
            "‚Ä¢ –ù–µ–¥–æ–≤–µ—Ä—á–∏–≤—ã–π\n"
            "‚Ä¢ \"–•–æ—á—É –ø–æ–¥—É–º–∞—Ç—å\"\n"
            "‚Ä¢ –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π\n"
            "‚Ä¢ –†–∞–∑–¥—Ä–∞–∂—ë–Ω–Ω—ã–π\n"
            "‚Ä¢ –°–ª–∏—à–∫–æ–º –∑–∞–Ω—è—Ç—ã–π\n"
            "‚Ä¢ –•–æ–ª–æ–¥–Ω—ã–π\n\n"
            "üí° –Ø –≤—ã–±–µ—Ä—É —Å–ª—É—á–∞–π–Ω—ã–π —Ç–∏–ø –∫–ª–∏–µ–Ω—Ç–∞ –∏ –±—É–¥—É –¥–∞–≤–∞—Ç—å —Ç–µ–±–µ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è.\n"
            "–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –º—è–≥–∫–æ –ø—Ä–µ–æ–¥–æ–ª–µ—Ç—å –∏—Ö –∏ –¥–æ–≤–µ—Å—Ç–∏ –¥–æ —Å–¥–µ–ª–∫–∏.\n\n"
            "–ü–æ—Å–ª–µ –¥–∏–∞–ª–æ–≥–∞ —è –¥–∞–º —Ç–µ–±–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π —Ä–∞–∑–±–æ—Ä!\n\n"
            "üîô –ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π /start"
        )
        
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        inline_kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üîÑ –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç", callback_data="obj_reset")],
            [InlineKeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="obj_status")]
        ])
        
        await message.reply(help_text, reply_markup=inline_kb, parse_mode="HTML")
    
    @dp.message_handler(lambda message: message.text == "üèÜ –í–∫—É—Å –ü–æ–±–µ–¥—ã")
    async def _menu_upsell(message: types.Message):
        """–ó–∞–ø—É—Å–∫ –º–æ–¥—É–ª—è –í–∫—É—Å –ü–æ–±–µ–¥—ã (–¥–æ–ø—Ä–æ–¥–∞–∂–∏)"""
        help_text = (
            "üèÜ <b>–í–∫—É—Å –ü–æ–±–µ–¥—ã</b> - –ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –¥–æ–ø—Ä–æ–¥–∞–∂\n\n"
            "üéØ <b>–¶–µ–ª—å:</b> –Ω–∞—É—á–∏—Ç—å—Å—è –º—è–≥–∫–∏–º –¥–æ–ø—Ä–æ–¥–∞–∂–∞–º –∏ –∞–∫—Ü–∏–∏ 3+1\n\n"
            "üí∞ <b>–ê–∫—Ü–∏—è:</b>\n"
            "–ü—Ä–∏ –∑–∞–∫–∞–∑–µ —Ç—Ä—ë—Ö –ø–µ—Å–µ–Ω ‚Äî —á–µ—Ç–≤—ë—Ä—Ç–∞—è –≤ –ø–æ–¥–∞—Ä–æ–∫!\n\n"
            "üì¶ <b>–¢–æ—á–∫–∏ –¥–æ–ø—Ä–æ–¥–∞–∂–∏:</b>\n"
            "‚Ä¢ –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞\n"
            "‚Ä¢ –ü–æ—Å–ª–µ –¥–µ–º–æ\n"
            "‚Ä¢ –ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∂–∞–Ω—Ä–∞/–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è\n\n"
            "üí° <b>–í–∞–∂–Ω–æ:</b>\n"
            "–ù–∏–∫–∞–∫–∏—Ö –∂—ë—Å—Ç–∫–∏—Ö –ø—Ä–æ–¥–∞–∂! –£–ø–æ—Ä –Ω–∞ –≤—ã–≥–æ–¥—É –∏ —É–¥–æ–±—Å—Ç–≤–æ.\n"
            "–ü–æ–∫–∞–∂–∏ –∫–ª–∏–µ–Ω—Ç—É —Ü–µ–Ω–Ω–æ—Å—Ç—å –∏ –ø–æ–º–æ–≥–∏ –µ–º—É –ø–æ–ª—É—á–∏—Ç—å –±–æ–ª—å—à–µ.\n\n"
            "üîô –ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π /start"
        )
        
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        inline_kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üîÑ –ù–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π", callback_data="up_reset")],
            [InlineKeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="up_status")]
        ])
        
        await message.reply(help_text, reply_markup=inline_kb, parse_mode="HTML")
    
    @dp.message_handler(lambda message: message.text == "üêâ –°–ø—è—â–∏–π –î—Ä–∞–∫–æ–Ω")
    async def _menu_sleeping_dragon(message: types.Message):
        """–ó–∞–ø—É—Å–∫ –º–æ–¥—É–ª—è –°–ø—è—â–∏–π –î—Ä–∞–∫–æ–Ω"""
        help_text = (
            "üêâ <b>–°–ø—è—â–∏–π –î—Ä–∞–∫–æ–Ω</b> - –†–∞–±–æ—Ç–∞ —Å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏\n\n"
            "üéØ <b>–¶–µ–ª—å:</b> –Ω–∞—É—á–∏—Ç—å—Å—è –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å \"–∑–∞–º–æ–ª—á–∞–≤—à–∏—Ö\" –∫–ª–∏–µ–Ω—Ç–æ–≤\n\n"
            "üìã <b>–°—Ü–µ–Ω–∞—Ä–∏–∏:</b>\n"
            "‚Ä¢ –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–ø–∞–ª –ø–æ—Å–ª–µ —Ç–µ–∫—Å—Ç–æ–≤\n"
            "‚Ä¢ –ö–ª–∏–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª –ø–æ—Å–ª–µ –¥–µ–º–æ\n"
            "‚Ä¢ –ö–ª–∏–µ–Ω—Ç –∑–∞–º–æ–ª—á–∞–ª –¥–æ –æ–ø–ª–∞—Ç—ã\n"
            "‚Ä¢ –ö–ª–∏–µ–Ω—Ç –ø—Ä–æ–ø–∞–ª –ø–æ—Å–ª–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∞–∫—Ü–∏–∏\n\n"
            "üìù <b>3 –≤–æ–ª–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π:</b>\n\n"
            "1Ô∏è‚É£ <b>–ü–µ—Ä–≤–∞—è –≤–æ–ª–Ω–∞</b>\n"
            "   ‚Ä¢ –¢—ë–ø–ª–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ\n"
            "   ‚Ä¢ –≠–º–ø–∞—Ç–∏—è\n"
            "   ‚Ä¢ –ê–∫–∫—É—Ä–∞—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å\n\n"
            "2Ô∏è‚É£ <b>–í—Ç–æ—Ä–∞—è –≤–æ–ª–Ω–∞</b>\n"
            "   ‚Ä¢ –î–æ–±–∞–≤–ª—è–µ–º —Ü–µ–Ω–Ω–æ—Å—Ç—å\n"
            "   ‚Ä¢ –ú–∏–∫—Ä–æ-–∏—Å—Ç–æ—Ä–∏—è, —ç–º–æ—Ü–∏—è\n"
            "   ‚Ä¢ –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –º–∏–Ω–∏-–¥–µ–º–æ –∏–ª–∏ –±–æ–Ω—É—Å–∞\n\n"
            "3Ô∏è‚É£ <b>–¢—Ä–µ—Ç—å—è –≤–æ–ª–Ω–∞</b>\n"
            "   ‚Ä¢ –£–≤–∞–∂–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü\n"
            "   ‚Ä¢ –ú—è–≥–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ\n"
            "   ‚Ä¢ –°–æ–æ–±—â–µ–Ω–∏–µ —á—Ç–æ –¥–≤–µ—Ä—å –≤—Å–µ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç–∞\n\n"
            "üí° –Ø –±—É–¥—É –∏–≥—Ä–∞—Ç—å —Ä–æ–ª—å –∫–ª–∏–µ–Ω—Ç–∞ –∏ –±—É–¥—É –ø–æ-—Ä–∞–∑–Ω–æ–º—É —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å.\n"
            "–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –≤–æ–ª–Ω—ã ‚Äî —Ä–∞–∑–±–æ—Ä —Ç–≤–æ–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π!\n\n"
            "üîô –ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π /start"
        )
        
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        inline_kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üîÑ –ù–æ–≤–∞—è —Å–∏—Ç—É–∞—Ü–∏—è", callback_data="sd_reset")],
            [InlineKeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="sd_status")]
        ])
        
        await message.reply(help_text, reply_markup=inline_kb, parse_mode="HTML")
    
    @dp.message_handler(lambda message: message.text == "üé≠ –ê—Ä–µ–Ω–∞")
    async def _menu_arena(message: types.Message):
        """–ó–∞–ø—É—Å–∫ –º–æ–¥—É–ª—è –ê—Ä–µ–Ω–∞"""
        from modules.arena.v4.engine import ArenaEngine
        
        user_id = str(message.from_user.id)
        arena = ArenaEngine(user_id)
        state = arena.snapshot()
        
        client_types_ru = {
            "silent": "–ú–æ–ª—á–∞–ª–∏–≤—ã–π", "talkative": "–†–∞–∑–≥–æ–≤–æ—Ä—á–∏–≤—ã–π", "rude": "–ì—Ä—É–±—ã–π",
            "polite": "–í–µ–∂–ª–∏–≤—ã–π", "busy": "–ó–∞–Ω—è—Ç–æ–π", "rich": "–ë–æ–≥–∞—Ç—ã–π",
            "poor": "–≠–∫–æ–Ω–æ–º–Ω—ã–π", "jokester": "–®—É—Ç–Ω–∏–∫", "logic": "–õ–æ–≥–∏–∫",
            "emotional": "–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π", "skeptic": "–°–∫–µ–ø—Ç–∏–∫", "warm": "–¢–µ–ø–ª—ã–π",
            "cold": "–•–æ–ª–æ–¥–Ω—ã–π", "doubtful": "–°–æ–º–Ω–µ–≤–∞—é—â–∏–π—Å—è", "dominant": "–î–æ–º–∏–Ω–∞–Ω—Ç–Ω—ã–π",
            "passive": "–ü–∞—Å—Å–∏–≤–Ω—ã–π", "detail": "–î–µ—Ç–∞–ª—å–Ω—ã–π", "fast": "–ë—ã—Å—Ç—Ä—ã–π",
            "slow": "–ú–µ–¥–ª–∏—Ç–µ–ª—å–Ω—ã–π", "expert": "–≠–∫—Å–ø–µ—Ä—Ç"
        }
        
        emotions_ru = {
            "calm": "üòå –°–ø–æ–∫–æ–µ–Ω",
            "neutral": "üòê –ù–µ–π—Ç—Ä–∞–ª–µ–Ω",
            "annoyed": "üò† –†–∞–∑–¥—Ä–∞–∂–µ–Ω",
            "angry": "üò° –ó–æ–ª",
            "excited": "üòÑ –í–∑–≤–æ–ª–Ω–æ–≤–∞–Ω"
        }
        
        ctype_name = client_types_ru.get(state['ctype'], state['ctype'])
        emotion_name = emotions_ru.get(state['emotion'], state['emotion'])
        
        help_text = (
            "üé≠ <b>–ê—Ä–µ–Ω–∞</b> - –°–≤–æ–±–æ–¥–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞\n\n"
            "üéØ <b>–¶–µ–ª—å:</b> –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–≤–æ–±–æ–¥–Ω—ã–π –¥–∏–∞–ª–æ–≥ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏\n\n"
            f"üë§ <b>–¢–µ–∫—É—â–∏–π –∫–ª–∏–µ–Ω—Ç:</b> {ctype_name}\n"
            f"{emotion_name}\n"
            f"üéö <b>–°–ª–æ–∂–Ω–æ—Å—Ç—å:</b> {state['difficulty']}\n\n"
            "üí¨ <b>–†–µ–∂–∏–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏:</b>\n"
            "–ù–∞—á–Ω–∏ –¥–∏–∞–ª–æ–≥ —Å –∫–ª–∏–µ–Ω—Ç–æ–º. –Ø –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏,\n"
            "–∫–∞–∫ –Ω–∞—Å—Ç–æ—è—â–∏–π –∫–ª–∏–µ–Ω—Ç —á–µ—Ä–µ–∑ DeepSeek AI.\n\n"
            "üìä <b>–í –∫–æ–Ω—Ü–µ –ø–æ–ª—É—á–∏—à—å –æ—Ü–µ–Ω–∫—É –ø–æ:</b>\n"
            "‚Ä¢ Empathy (—ç–º–ø–∞—Ç–∏—è)\n"
            "‚Ä¢ CTA (–ø—Ä–∏–∑—ã–≤ –∫ –¥–µ–π—Å—Ç–≤–∏—é)\n"
            "‚Ä¢ Timing (—Ç–∞–π–º–∏–Ω–≥)\n"
            "‚Ä¢ Clarity (—è—Å–Ω–æ—Å—Ç—å)\n"
            "‚Ä¢ Value (—Ü–µ–Ω–Ω–æ—Å—Ç—å)\n"
            "‚Ä¢ Upsell (–¥–æ–ø—Ä–æ–¥–∞–∂–∏)\n\n"
            "üîô –ß—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é, –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π /start"
        )
        
        from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
        inline_kb = InlineKeyboardMarkup(inline_keyboard=[
            [InlineKeyboardButton(text="üîÑ –ù–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç", callback_data="arena_reset")],
            [InlineKeyboardButton(text="üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", callback_data="arena_status")],
            [InlineKeyboardButton(text="üéØ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å –æ—Ü–µ–Ω–∫—É", callback_data="arena_finish")]
        ])
        
        await message.reply(help_text, reply_markup=inline_kb, parse_mode="HTML")
